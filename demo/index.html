<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lightspeed lightbox</title>
  <link rel="stylesheet" href="../src/style.css">
  <link rel="stylesheet" href="../src/lsb-style.css">
  <script src="../src/jquery-2.2.3.min.js"></script>
    <script>
    $(window).load(function(){
      var $lsb = $('.lightspeed-box');
      var $spinner = $('.fading-spinner');
      var $lsbImage = $lsb.find('.lsb-image');
      var $next = $lsb.find('.lsb-next');
      var $prev = $lsb.find('.lsb-prev');
      
      var imageCollection = {
        current: null, 
        collection: [],
        getImagesInSet: function(currentHref, groupAttr) {
          var images = $('.lightspeed-preview');
          
          console.log(this.current);
          var hrefCollection = [];
          var currentImage = null;
    
          images.each(function(i, element) {
            var elementHref = element.getAttribute('href');
            hrefCollection.push(elementHref);
            if(elementHref === currentHref) {
              currentImage = i;
            }
          });
          
          this.collection = hrefCollection;
          this.current = currentImage;
        },
        nextImage: function() {
          if(this.collection.length <= 1) {
            return '';
          }
          
          this.current += 1;
          if (this.current > this.collection.length - 1) {
            this.current = 0;
          }
          
          return this.collection[this.current];
        },
        previousImage: function() {
          if(this.collection.length <= 1) {
            return '';
          }
          
          this.current -= 1;
          if (this.current < 0) {
            this.current = this.collection.length - 1;
          }
          
          return this.collection[this.current];
        },
        canSwitch: function() {
          return this.collection > 0;
        }
      };
      
      $next.click(function(event) {
        event.preventDefault();
        var img = imageCollection.nextImage();
        switchImage(img);
      });
      
      $lsb.click(function(event) {
        $lsb.removeClass('lsb-active');
        $lsbImage.removeClass('lsb-image-loaded');
        $lsbImage.addClass('lsb-noimage');
      });
      
      $('.lightspeed-preview').click(function(event){
        event.preventDefault();        
        var fullSizeHref = event.target.parentElement.getAttribute('href');
        switchImage(fullSizeHref);
        });
      
      function switchImage(href) {
        // Show lightbox and spinner.
        $lsb.addClass('lsb-active');
        $spinner.css('opacity', 1);
        
        //Load image.
        var $img = $('<img />').attr('src', href).on('load', function() {
          // Get all images to set.
          imageCollection.getImagesInSet(href);
          
          console.log('Here is an image:', $img[0].naturalWidth, $img[0].naturalHeight);
          if (!this.complete || typeof this.naturalWidth == "undefined" || this.naturalWidth == 0) {
              // Image is broken.
              //$template.append('<span>No Image</span>');
            } else {
              $spinner.css('opacity', 0);
              //$lsbImage = $lsb.find('.lsb-image');
              $lsbImage.removeClass('lsb-noimage');
              $lsbImage.attr('src', $img.attr('src'));
              $lsbImage.addClass('lsb-image-loaded');
              // Change size of an image
              var imagePadding = 50;
              var docCalcWidth = window.innerWidth - imagePadding * 2; 
              // Check if window less then 30;
              var docCalcHeight = window.innerHeight - imagePadding * 2;
              var imgWidth = $img[0].naturalWidth;
              var imgHeight = $img[0].naturalHeight;
              
              if (imgWidth > docCalcWidth) {
                var widthDelta = imgWidth - docCalcWidth;
                imgWidth -= widthDelta;
                imgHeight -= widthDelta;
              }
              
              if (imgHeight > docCalcHeight) {
                var heightDelta = imgHeight - docCalcHeight;
                imgHeight -= heightDelta;
                imgWidth -= heightDelta;
              }
            }
      });
      }
    });
    </script>
</head>
<body>
<div class="lightspeed-box">
  <div class="lsb-content">
    <img class="lsb-image lsb-noimage">
    <div class="fading-spinner wait-icon">
      <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
    </div>
    <div class="lsb-controls">
      <span class="lsb-prev">&lt;&nbsp;</span>
      <span class="lsb-next">&nbsp;&gt;</span>
    </div>
  </div>
</div>
<!--
<div class="lightspeed-box">
 <div class="lightspeed-image">
  <div class="fading-spinner">
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
        <div class="spin-circle"></div>
      </div>
</div>
  </div>
-->
<header>
  <h1>Image gallery</h1>
</header>
<article>
  <section id="gallery">
    <figure class="item">
      
      <header class="header">Hello world</header>
      <a class="lightspeed-preview" href="img/day_1.png"><img src="img/01day_1.png" alt="Day 1"></a>
      <div class="description">
        This is a sample image
      </div>
    </figure>
    
    <figure class="item">
      <header class="header">Hello world</header>
      <a class="lightspeed-preview" href="img/day_10.png"><img src="img/02day_10.png" alt="Day 2"></a>
      <div class="description">
        This is a sample image
      </div>
    </figure>
    
    <figure class="item">
      <header class="header">Standing girl</header>
      <a class="lightspeed-preview" href="img/day_11.png"><img src="img/03day_11.png" alt="Day 3"></a>
      <div class="description">
        Standing Girl
      </div>
    </figure>
    
    <figure class="item">
      <header class="header">Hello world</header>
      <a class="lightspeed-preview" href="img/day_1.png"><img src="img/04day_12.png" alt="Day 4"></a>
      <div class="description">
        This is a sample image
      </div>
    </figure>
  </section>
</article>
</body>
</html>